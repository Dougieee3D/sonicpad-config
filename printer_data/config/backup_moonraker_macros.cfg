# ---- Manual backup via Moonraker (no gcode_shell_command required) ----
[gcode_macro BACKUP_NOW]
description: Run klipper-backup immediately and push to Git
gcode:
  {% set cmd = "/home/sonic/klipper-backup/scripts/backup.sh" %}
  {action_respond_info("BACKUP_NOW: running " + cmd)}
  {action_call_remote_method(
      "machine.shell_command",
      {"command": cmd, "timeout": 1800, "verbose": True}
  )}

[gcode_macro BACKUP_STATUS]
description: Show next and last times for the klipper-backup.timer
gcode:
  {% set cmd = "bash -lc \\"systemctl --user list-timers klipper-backup.timer | sed -n '2p'\\"" %}
  {action_call_remote_method(
      "machine.shell_command",
      {"command": cmd, "timeout": 10, "verbose": True}
  )}
  {action_respond_info("Tip: The output line shows NEXT | LEFT | LAST | PASSED | UNIT")}
